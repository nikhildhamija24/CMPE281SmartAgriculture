(function(n){n.fn.mrjsontablecolumn=function(t){var i=this.selector;return n.extend({},n.fn.mrjsontablecolumn.defaults,t)};n.fn.mrjsontablecolumn.defaults={heading:"Heading",data:"json_field",type:"string",sortable:!0,starthidden:!1};n.fn.mrjsontable=function(t){var h=this.selector,i=n.extend({},n.fn.mrjsontable.defaults,t),u=n("<div>",{"data-so":"A","data-ps":i.pageSize}).addClass("mrjt"),f=n("<div>").addClass("legend"),e=n("<table>").addClass(i.tableClass),c=n("<thead>"),l=n("<tr>"),o,s,r;if(n.each(i.columns,function(t,r){var u=n("<th>").attr("data-i",t),e=n("<input>",{type:"checkbox",id:"cb"+h+t,value:t,checked:!r.starthidden,"data-i":t}).bind("change",i.onHiddenCBChange).appendTo(f),o=n("<label />",{"for":"cb"+h+t,text:r.heading}).appendTo(f);r.starthidden&&u.hide();r.sortable?n("<a>",{"class":"s-init",href:"#","data-i":t,"data-t":r.type}).text(r.heading).bind("click",i.onSortClick).appendTo(u):n("<span>").text(r.heading).appendTo(u);u.appendTo(l)}),l.appendTo(c),c.appendTo(e),o=!1,n.each(i.data,function(t,r){var u=n("<tr>").attr("data-i",t);i.pageSize<=t&&(u.hide(),o=!0);n.each(i.columns,function(t,i){var f=n("<td>").text(r[i.data]).attr("data-i",t);i.starthidden&&f.hide();f.appendTo(u)});u.appendTo(e)}),u.append(f),u.append(e),o){for(s=n("<div>").addClass("paging"),r=0;r<Math.ceil(i.data.length/i.pageSize);r++)n("<a>",{text:"Page "+(r+1),href:"#","data-i":r+1,"class":"p-link"}).bind("click",i.onPageClick).appendTo(s);u.append(s).addClass("paged")}return this.append(u)};n.fn.mrjsontable.defaults={cssClass:"table",columns:[],data:[],pageSize:10,onHiddenCBChange:function(){var t=n(this).parents(".mrjt"),i=n(this).attr("data-i");n(this).is(":checked")?(n("td[data-i='"+i+"']",t).show(),n("th[data-i='"+i+"']",t).show()):(n("td[data-i='"+i+"']",t).hide(),n("th[data-i='"+i+"']",t).hide())},onPageClick:function(){var t=n(this).parents(".mrjt"),i=t.attr("data-ps"),r=n(this).attr("data-i");return n("tbody tr",t).each(function(t){n(this).hide();var u=(r-1)*i+1,f=r*i;t+1>=u&&t+1<=f&&n(this).show()}),!1},onSortClick:function(){var t=n(this).parents(".mrjt"),f=t.attr("data-so"),r,u;n(".s-init",t).removeClass("s-A s-D");n(this).addClass("s-"+f);var e=n(this).attr("data-t"),o=n(this).attr("data-i"),i=[];for(n("tbody tr",t).each(function(t,r){var u=n("td",r).eq(o),s=u.parent().attr("data-i"),f=null;switch(e){case"string":f=u.text();break;case"int":f=parseInt(u.text());break;case"float":f=parseFloat(u.text());break;case"datetime":f=new Date(u.text());break;default:f=u.text()}i.push({tr_id:s,val:f})}),f=="A"?(i.sort(function(n,t){return n.val>t.val?1:n.val<t.val?-1:0}),t.attr("data-so","D")):(i.sort(function(n,t){return n.val<t.val?1:n.val>t.val?-1:0}),t.attr("data-so","A")),r=0;r<i.length;r++)u=n("tr[data-i='"+i[r].tr_id+"']",t),u.detach(),n("tbody",t).append(u);return t.hasClass("paged")&&n(".p-link",t).eq(0).click(),!1}}})(jQuery);